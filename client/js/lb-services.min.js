!function(e,r,t){"use strict";var s="/api",o="authorization",n=r.module("lbServices",["ngResource"]);n.factory("Users",["LoopBackResource","LoopBackAuth","$injector",function(e,r){var o=e(s+"/Users/:id",{id:"@id"},{prototype$__findById__accessTokens:{url:s+"/Users/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{url:s+"/Users/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{url:s+"/Users/:id/accessTokens/:fk",method:"PUT"},prototype$__findById__roles:{url:s+"/Users/:id/roles/:fk",method:"GET"},prototype$__destroyById__roles:{url:s+"/Users/:id/roles/:fk",method:"DELETE"},prototype$__updateById__roles:{url:s+"/Users/:id/roles/:fk",method:"PUT"},prototype$__link__roles:{url:s+"/Users/:id/roles/rel/:fk",method:"PUT"},prototype$__unlink__roles:{url:s+"/Users/:id/roles/rel/:fk",method:"DELETE"},prototype$__exists__roles:{url:s+"/Users/:id/roles/rel/:fk",method:"HEAD"},prototype$__get__accessTokens:{isArray:!0,url:s+"/Users/:id/accessTokens",method:"GET"},prototype$__create__accessTokens:{url:s+"/Users/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:s+"/Users/:id/accessTokens",method:"DELETE"},prototype$__count__accessTokens:{url:s+"/Users/:id/accessTokens/count",method:"GET"},prototype$__get__roles:{isArray:!0,url:s+"/Users/:id/roles",method:"GET"},prototype$__create__roles:{url:s+"/Users/:id/roles",method:"POST"},prototype$__delete__roles:{url:s+"/Users/:id/roles",method:"DELETE"},prototype$__count__roles:{url:s+"/Users/:id/roles/count",method:"GET"},create:{url:s+"/Users",method:"POST"},upsert:{url:s+"/Users",method:"PUT"},exists:{url:s+"/Users/:id/exists",method:"GET"},findById:{url:s+"/Users/:id",method:"GET"},find:{isArray:!0,url:s+"/Users",method:"GET"},findOne:{url:s+"/Users/findOne",method:"GET"},updateAll:{url:s+"/Users/update",method:"POST"},deleteById:{url:s+"/Users/:id",method:"DELETE"},count:{url:s+"/Users/count",method:"GET"},prototype$updateAttributes:{url:s+"/Users/:id",method:"PUT"},login:{params:{include:"user"},interceptor:{response:function(e){var t=e.data;return r.setUser(t.id,t.userId,t.user),r.rememberMe=e.config.params.rememberMe!==!1,r.save(),e.resource}},url:s+"/Users/login",method:"POST"},logout:{interceptor:{response:function(e){return r.clearUser(),r.clearStorage(),e.resource}},url:s+"/Users/logout",method:"POST"},confirm:{url:s+"/Users/confirm",method:"GET"},resetPassword:{url:s+"/Users/reset",method:"POST"},getCurrent:{url:s+"/Users/:id",method:"GET",params:{id:function(){var e=r.currentUserId;return null==e&&(e="__anonymous__"),e}},interceptor:{response:function(e){return r.currentUserData=e.data,e.resource}},__isGetCurrentUser__:!0}});return o.updateOrCreate=o.upsert,o.update=o.updateAll,o.destroyById=o.deleteById,o.removeById=o.deleteById,o.getCachedCurrent=function(){var e=r.currentUserData;return e?new o(e):null},o.isAuthenticated=function(){return null!=this.getCurrentId()},o.getCurrentId=function(){return r.currentUserId},o.modelName="Users",o}]),n.factory("LoopBackAuth",function(){function s(){var r=this;e.forEach(function(e){r[e]=n(e)}),this.rememberMe=t,this.currentUserData=null}function o(e,t,s){var o=r+t;null==s&&(s=""),e[o]=s}function n(e){var t=r+e;return localStorage[t]||sessionStorage[t]||null}var e=["accessTokenId","currentUserId"],r="$LoopBack$";return s.prototype.save=function(){var r=this,t=this.rememberMe?localStorage:sessionStorage;e.forEach(function(e){o(t,e,r[e])})},s.prototype.setUser=function(e,r,t){this.accessTokenId=e,this.currentUserId=r,this.currentUserData=t},s.prototype.clearUser=function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null},s.prototype.clearStorage=function(){e.forEach(function(e){o(sessionStorage,e,null),o(localStorage,e,null)})},new s}).config(["$httpProvider",function(e){e.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","LoopBackAuth",function(e,r){return{request:function(n){if(n.url.substr(0,s.length)!==s)return n;if(r.accessTokenId)n.headers[o]=r.accessTokenId;else if(n.__isGetCurrentUser__){var u={body:{error:{status:401}},status:401,config:n,headers:function(){return t}};return e.reject(u)}return n||e.when(n)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(e){o=e},this.setUrlBase=function(e){s=e},this.$get=["$resource",function(e){return function(r,t,s){var o=e(r,t,s);return o.prototype.$save=function(e,r){var t=o.upsert.call(this,{},this,e,r);return t.$promise||t},o}}]})}(window,window.angular);